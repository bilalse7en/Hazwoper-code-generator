<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Content Generator</title>
    <link rel="icon" href="" type="image/gif" id="animatedFavicon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #007bff, #260064);
            --primary-gradient-hover: linear-gradient(135deg, #260064, #007bff);
            --success-gradient: linear-gradient(135deg, #09ad30, #003b0d);
            --success-gradient-hover: linear-gradient(135deg, #003b0d, #09ad30);
            --secondary-gradient: linear-gradient(135deg, #707070, #2b2b2b);
            --secondary-gradient-hover: linear-gradient(135deg, #2b2b2b, #707070);
            --dark-bg: #1e1e2d;
            --darker-bg: #2a2a40;
            --card-bg: #2a2a40;
            --text-primary: #e9ecef;
            --text-secondary: #adb5bd;
            --border-color: #495057;
        }
        body { background-color: var(--dark-bg); color: var(--text-primary); font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .hero-section { background: linear-gradient(135deg, var(--dark-bg) 0, var(--darker-bg) 100%); padding: 30px 0; margin-bottom: 30px; }
        .hero-section h1 { font-size: 2.5rem; font-weight: 700; background: linear-gradient(to right, #007bff, #17a2b8); background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-align: center; }
        .card { background-color: var(--card-bg); border: none; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,.15); }
        .card-header { background-color: #343a40; border-bottom: 1px solid var(--border-color); color: #d6d6d6; }
        .btn-primary { background: var(--primary-gradient); border: none; }
        .btn-success { background: var(--success-gradient); border: none; }
        .btn-secondary { background: transparent; border: none; color: darkgrey;}
        .btn-info { background: linear-gradient(135deg, #17a2b8, #0d3c45); border: none; }
        .btn-hover:hover { transition: 0.2s; transform: translate(-3px, -5px) scale(1.02);}
        .preview-box { max-height: 400px; overflow: auto; color: #fff; background: var(--dark-bg); border-radius: 8px; padding: 1rem; border: 1px solid var(--border-color); }
        .preview-box .sbox { margin: 10px 0; border: 1px solid #f5f5f5; background: #fff; padding: 10px 18px; box-shadow: 0 0 0px 1px rgba(20,23,28,.1), 0 3px 1px 0 rgba(20,23,28,.1); color: #000; }
        .preview-box .objective-tab-list { list-style-type: disc; margin-left: 20px; }
        .file-info, .progress-container { display: none; }
        .notification { position: fixed; top: 20px; right: 20px; z-index: 9999; min-width: 300px; }
        .nav-tabs .nav-link { color: var(--text-secondary); border: 1px solid var(--border-color); border-bottom: none; border-radius: 5px 5px 0 0; margin-right: 5px; padding: 12px 24px; font-weight: 500; transition: .3s; }
        .nav-tabs .nav-link.active { background-color: var(--card-bg); color: #f8f9fa; border-color: var(--border-color); border-bottom-color: var(--card-bg); }
        .tab-content { background-color: var(--card-bg); border: 1px solid var(--border-color); border-top: none; border-radius: 0 0 5px 5px; padding: 20px; }
        .glossaryBtnMain { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; }
        .glosary-item { margin-top: 20px; }
        .glosary-item h2 { color: #17a2b8; border-bottom: 1px solid var(--border-color); padding-bottom: 5px; margin-bottom: 15px; }
        .custom-glossary { padding: 20px; background-color: var(--card-bg); border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,.1); }
        .alphabet-buttons { display: flex; flex-wrap: wrap; gap: 5px; justify-content: center; margin-bottom: 20px; }
        .alphabet-buttons button { flex: 0 0 calc(100% / 13 - 5px); max-width: calc(100% / 13 - 5px); }
        .pdf-color { color: #e74c3c; }
        .fa-link { color: #2c6fbb; }
        .glossary-row { background-color: #2c2400 !important; }
        .bg-gray-300 td { background: #ff9191 !important; color: #7a0000 !important; text-decoration: line-through; text-decoration-style: double;}
        .faq-item { border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; margin-bottom: 15px; background: var(--darker-bg); }
        .faq-question { font-weight: bold; color: #ffc107; margin-bottom: 10px; }
        .faq-answer { color: var(--text-primary); }
        .copy-btn { margin: 5px 0; }
        @media (max-width: 768px) { .alphabet-buttons button { flex: 0 0 calc(100% / 7 - 5px); max-width: calc(100% / 7 - 5px); } }
        textarea { scrollbar-width: thin; scrollbar-color: #c1c1c1 #2a2a40;}
        a[download] { text-decoration: none !important; color: inherit !important; }
        a[download]:hover, a[download]:focus { text-decoration: none !important; color: inherit !important; }
        
        /* Blog Content Styles */
        .blog-content { color: #333; background: white; padding: 20px; border-radius: 8px; }
        .blog-content h1 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-top: 0; }
        .blog-content h2 { color: #34495e; margin-top: 25px; margin-bottom: 15px; }
        .blog-content h3 { color: #7f8c8d; margin-top: 20px; margin-bottom: 12px; }
        .blog-content p { line-height: 1.6; margin-bottom: 15px; }
        .blog-content img { max-width: 100%; height: auto; border-radius: 8px; margin: 15px 0; }
        .blog-content ul, .blog-content ol { margin-bottom: 15px; padding-left: 20px; }
        .blog-content li { margin-bottom: 5px; line-height: 1.5; }
        
        /* Center H1 headings */
        .blog-content h1.text-center {
            text-align: center;
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 20px;
        }
        
        /* Highlight the featured image section */
        .featured-image-section {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            background-color: rgba(0, 123, 255, 0.1);
        }
    </style>
</head>
<body>
<div class="hero-section">
    <div class="container">
        <div class="row"> 
            <div class="col-auto mb-4 text-center">
                <img src="https://staging-media.hazwoper-osha.com/wp-content/uploads/2025/10/1759824844/logo.gif" alt="Website Logo" style="height: 125px;width: auto;border-radius: 50%;" class="position-absolute">
            </div>
            <h1>Course Content Generator Suite</h1><p class="lead text-center text-light">Extract Overview, Syllabus, FAQs, Glossary, Resources and Blog Content from your documents</p>
        </div>
    </div>
</div>

<div class="container mb-5">
    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="course-tab" data-bs-toggle="tab" data-bs-target="#course" type="button" role="tab" aria-controls="course" aria-selected="true">
                <i class="fas fa-graduation-cap me-2"></i>Web Content Generator
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="glossary-tab" data-bs-toggle="tab" data-bs-target="#glossary" type="button" role="tab" aria-controls="glossary" aria-selected="false">
                <i class="fas fa-book me-2"></i>Glossary Generator
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="resources-tab" data-bs-toggle="tab" data-bs-target="#resources" type="button" role="tab" aria-controls="resources" aria-selected="false">
                <i class="fas fa-file-excel me-2"></i>Resource Generator
            </button>
        </li>
        <li class="nav-item" role="presentation"></li>
            <button class="nav-link" id="blog-tab" data-bs-toggle="tab" data-bs-target="#blog" type="button" role="tab" aria-controls="blog" aria-selected="false">
                <i class="fas fa-blog me-2"></i>Blog Generator
            </button>
        </li>
    </ul>
    
    <div class="tab-content" id="myTabContent">
        <!-- Course Content Tab -->
        <div class="tab-pane fade show active" id="course" role="tabpanel" aria-labelledby="course-tab">
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-4">
                        <h3 class="mb-3"><i class="fas fa-file-word text-warning me-2"></i>Upload DOCX File</h3>
                        <hr class="bg-warning">
                        
                        <!-- Course Name Input -->
                        <div class="mb-3">
                            <label for="courseNameInput" class="form-label">Course Name</label>
                            <input type="text" class="form-control" id="courseNameInput" placeholder="Enter course name (e.g., Swing Stage Scaffold Training)">
                        </div>
                        
                        <!-- Demo File Download Button -->
                        <div class="mb-3">
                            <p>Download our demo file to check the required structure. Create your course file following the same format, then upload for easy website content code generation.</p>
                            <button class="btn-hover btn btn-outline-primary btn-sm" onclick="downloadDemoFile()">
                                <i class="fas fa-download me-2"></i>Download Demo File
                            </button>
                        </div>
                        
                        <input class="form-control" type="file" id="courseFileInput" accept=".docx" />
                        <div class="file-info" id="courseFileInfo"></div>
                    </div>
                    
                    <div class="progress-container" id="courseProgress">
                        <div class="progress"><div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div></div>
                        <div class="text-center mt-2" id="courseProgressText">Processing...</div>
                    </div>
        
                    <div class="d-grid gap-2 d-md-block mb-4">
                        <button class="btn-hover btn btn-primary btn-lg me-2 mb-2" onclick="uploadCourseFile()"><i class="fas fa-upload me-2"></i>Upload File</button>
                        <button class="btn-hover btn btn-success btn-lg me-2 mb-2" onclick="generateOverviewCode()"><i class="fas fa-code me-2"></i>Generate Overview</button>
                        <button class="btn-hover btn btn-success btn-lg me-2 mb-2" onclick="generateCourseObjectivesCode()"><i class="fas fa-code me-2"></i>Course Objectives</button>
                        <button class="btn-hover btn btn-success btn-lg me-2 mb-2" onclick="generateSyllabusCode()"><i class="fas fa-code me-2"></i>Generate Syllabus</button>
                        <button class="btn-hover btn btn-success btn-lg me-2 mb-2" onclick="generateFAQCode()"><i class="fas fa-code me-2"></i>Generate FAQ</button>
                        <button class="btn-hover btn btn-info btn-lg me-2 mb-2" onclick="debugExtraction()"><i class="fas fa-bug me-2"></i>Debug Extraction</button>
                    </div>
                </div>
        
                <div class="col-md-6">
                    <h3 class="mb-3"><i class="fas fa-code text-warning me-2"></i>Overview Code</h3><hr class="bg-warning">
                    <div class="position-relative">
                        <div class="position-absolute end-0"><button class="btn-hover btn-secondary rounded-start-0 rounded-top text-bg-warning" onclick="copyToClipboard('overviewCode')"><i class="fas fa-copy"></i></button></div>
                        <textarea class="form-control pe-4" id="overviewCode" rows="4" readonly></textarea>
                    </div>
                    
                    <h3 class="mb-3 mt-4"><i class="fas fa-code text-warning me-2"></i>Course Objectives Code</h3><hr class="bg-warning">
                    <div class="position-relative">
                        <div class="position-absolute end-0"><button class="btn-hover btn-secondary rounded-start-0 rounded-top text-bg-warning" onclick="copyToClipboard('courseObjectivesCode')"><i class="fas fa-copy"></i></button></div>
                        <textarea class="form-control pe-4" id="courseObjectivesCode" rows="4" readonly></textarea>    
                    </div>
                    
                    <h3 class="mb-3 mt-4"><i class="fas fa-code text-warning me-2"></i>Syllabus Code</h3><hr class="bg-warning">
                    <div class="position-relative">
                        <div class="position-absolute end-0"><button class="btn-hover btn-secondary rounded-start-0 rounded-top text-bg-warning" onclick="copyToClipboard('syllabusCode')"><i class="fas fa-copy"></i></button></div>
                        <textarea class="form-control pe-4" id="syllabusCode" rows="4" readonly></textarea>
                    </div>

                    <h3 class="mb-3 mt-4"><i class="fas fa-code text-info me-2"></i>FAQ Code</h3><hr class="bg-info">
                    <div class="position-relative">
                        <div class="position-absolute end-0"><button class="btn-hover btn-secondary rounded-start-0 rounded-top text-bg-warning" onclick="copyToClipboard('faqCode')"><i class="fas fa-copy"></i></button></div>
                        <textarea class="form-control pe-4" id="faqCode" rows="4" readonly></textarea>
                    </div>
                    
                    <div class="mt-4" id="faqIndividualItems" style="display: none;">
                        <h4 class="mb-3"><i class="fas fa-copy text-warning me-2"></i>Individual FAQ Items</h4>
                        <hr class="bg-warning">
                        <div id="faqItemsContainer"></div>
                    </div>
                </div>
            </div>
            
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header"><h5 class="mb-0">Preview</h5></div>
                        <div class="card-body preview-box" id="coursePreview">Preview will appear here after generation</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Blog Tab -->
        <div class="tab-pane fade" id="blog" role="tabpanel" aria-labelledby="blog-tab">
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-4">
                        <h3 class="mb-3"><i class="fas fa-file-word text-warning me-2"></i>Upload DOCX File</h3>
                        <hr class="bg-warning">
                        <input class="form-control" type="file" id="blogFileInput" accept=".docx" />
                        <div class="file-info" id="blogFileInfo"></div>
                    </div>
                    
                    <!-- Featured Image Section - ALWAYS VISIBLE -->
                    <div class="featured-image-section">
                        <h4 class="mb-3"><i class="fas fa-star text-warning me-2"></i>Featured Image (Appears after H1)</h4>
                        <div class="mb-3">
                            <label class="form-label text-light">Image URL:</label>
                            <input type="text" class="form-control" id="featuredImageUrl" 
                                   placeholder="https://example.com/featured-image.jpg">
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-light">Alt Text:</label>
                            <input type="text" class="form-control" id="featuredImageAlt" 
                                   placeholder="Description of the image for accessibility">
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-light">Title Text:</label>
                            <input type="text" class="form-control" id="featuredImageTitle" 
                                   placeholder="Title of the image">
                        </div>
                    </div>
                    
                    <div class="progress-container" id="blogProgress">
                        <div class="progress"><div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div></div>
                        <div class="text-center mt-2" id="blogProgressText">Processing...</div>
                    </div>

                    <div class="d-grid gap-2 d-md-block mb-4">
                        <button class="btn-hover btn btn-primary btn-lg me-2 mb-2" onclick="uploadBlogFile()"><i class="fas fa-upload me-2"></i>Upload File</button>
                        <button class="btn-hover btn btn-success btn-lg me-2 mb-2" onclick="generateBlogCode()"><i class="fas fa-code me-2"></i>Generate Blog Code</button>
                    </div>
                    
                    <div id="imageInputsContainer" class="mb-4" style="display: none;">
                        <h4 class="mb-3"><i class="fas fa-images text-info me-2"></i>Content Images</h4>
                        <hr class="bg-info">
                        <p class="text-light">Add image URLs that appear in your blog content.</p>
                        <div id="imageInputs"></div>
                        <button class="btn btn-outline-info btn-sm mt-2" onclick="addImageInput()"><i class="fas fa-plus me-1"></i>Add Another Image</button>
                    </div>
                </div>

                <div class="col-md-6">
                    <h3 class="mb-3"><i class="fas fa-code text-warning me-2"></i>Generated Blog Code</h3>
                    <hr class="bg-warning">
                    <div class="position-relative">
                        <div class="position-absolute end-0"><button class="btn-hover btn-secondary rounded-start-0 rounded-top text-bg-warning" onclick="copyToClipboard('blogCode')"><i class="fas fa-copy"></i></button></div>
                        <textarea class="form-control pe-4" id="blogCode" rows="15" readonly></textarea>
                    </div>
                </div>
            </div>
            
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header"><h5 class="mb-0">Preview</h5></div>
                        <div class="card-body preview-box">
                            <div id="blogPreview" class="blog-content">Blog preview will appear here after generation</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Glossary Tab -->
        <div class="tab-pane fade" id="glossary" role="tabpanel" aria-labelledby="glossary-tab">
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-4">
                        <h3 class="mb-3"><i class="fas fa-file-word text-primary me-2"></i>Upload DOCX File</h3>
                        <hr class="bg-primary">
                        <input class="form-control" type="file" id="glossaryFileInput" accept=".docx" />
                        <div class="file-info" id="glossaryFileInfo"></div>
                    </div>
                    
                    <div class="progress-container" id="glossaryProgress">
                        <div class="progress">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                        </div>
                        <div class="text-center mt-2" id="glossaryProgressText">Processing...</div>
                    </div>
    
                    <div class="d-grid gap-2 d-md-block mb-4">
                        <button class="btn-hover btn btn-primary btn-lg me-2 mb-2" onclick="uploadGlossaryFile()">
                            <i class="fas fa-upload me-2"></i>Upload File
                        </button>
                        <button class="btn-hover btn btn-success btn-lg me-2 mb-2" onclick="generateGlossary()">
                            <i class="fas fa-code me-2"></i>Generate Glossary Code
                        </button>
                    </div>
                    
                    <div class="card mt-4">
                        <div class="card-header">
                            <h5 class="mb-0">Preview</h5>
                        </div>
                        <div class="card-body preview-box" id="glossaryPreview">
                            Preview will appear here after generation
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <h3 class="mb-3"><i class="fas fa-code text-success me-2"></i>Generated Code</h3>
                    <hr class="bg-success">
                    <div class="position-relative">
                        <div class="position-absolute end-0">
                            <button class="btn-hover btn-secondary rounded-start-0 rounded-top text-bg-warning" onclick="copyToClipboard('glossaryCode')"><i class="fas fa-copy"></i></button>
                        </div>
                        <textarea class="form-control" id="glossaryCode" rows="15" readonly></textarea>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Resources Tab -->
        <div class="tab-pane fade" id="resources" role="tabpanel" aria-labelledby="resources-tab">
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-4">
                        <h3 class="mb-3"><i class="fas fa-file-excel text-success me-2"></i>Upload Excel File</h3>
                        <hr class="bg-success">
                        <input id="resourceFileInput" type="file" accept=".xlsx,.xls" class="form-control"/>
                        <div class="file-info" id="resourceFileInfo"></div>
                    </div>
                    
                    <div class="progress-container" id="resourceProgress">
                        <div class="progress">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                        </div>
                        <div class="text-center mt-2" id="resourceProgressText">Processing...</div>
                    </div>
                    
                    <div class="d-grid gap-2 d-md-block mb-4">
                        <button class="btn-hover btn btn-primary btn-lg mb-2" onclick="processResourceFile()">
                            <i class="fas fa-upload me-2"></i>Process File
                        </button>
                    </div>
                    
                    <div class="card mt-4">
                        <div class="card-header">
                            <h5 class="mb-0">Preview</h5>
                        </div>
                        <div class="card-body preview-box" id="resourcePreview">
                            Preview will appear here after processing
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <h3 class="mb-3"><i class="fas fa-code text-primary me-2"></i>Generated HTML</h3>
                    <hr class="bg-primary">
                    <div class="position-relative">
                        <div class="position-absolute end-0"><button class="btn-hover btn-secondary rounded-start-0 rounded-top text-bg-warning" onclick="copyToClipboard('htmlOutput')"><i class="fas fa-copy"></i></button></div>
                        <textarea class="form-control" id="htmlOutput" rows="15" readonly></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // ========== ANIMATED FAVICON ==========
function createAnimatedFavicon() {
    // Add your frame image URLs here
    const frameUrls = [
        'https://api.imghippo.com/files/xaDF5036Pg.webp',
        'https://api.imghippo.com/files/Byw8441LyU.webp',
        'https://api.imghippo.com/files/OMRB5894PM.webp',
        'https://api.imghippo.com/files/OMRB5894PM.webp',
        'https://api.imghippo.com/files/aWwT8956okE.webp',
        'https://api.imghippo.com/files/szpK3253uQ.webp',
        'https://api.imghippo.com/files/OCNp9289B.webp',
        'https://api.imghippo.com/files/Cve4428hjE.webp',
        'https://api.imghippo.com/files/oEdX3633KQ.webp',
        'https://api.imghippo.com/files/pe5312jh.webp',
        'https://api.imghippo.com/files/tN6032k.webp',
        'https://api.imghippo.com/files/ALhs5878PIM.webp',
        'https://api.imghippo.com/files/jJ7827D.webp',
        'https://api.imghippo.com/files/hHv5541MA.webp',
        'https://api.imghippo.com/files/JTKk1632gk.webp',
        'https://api.imghippo.com/files/cy6079QM.webp',
        'https://api.imghippo.com/files/hzUt2965X.webp',
        'https://api.imghippo.com/files/Tngt2746aI.webp',
        'https://api.imghippo.com/files/tNI6716EY.webp',
        'https://api.imghippo.com/files/fdzK3248hwE.webp',
        'https://api.imghippo.com/files/WmU5310QWs.webp',
        'https://api.imghippo.com/files/btnl8092nWk.webp',
        'https://api.imghippo.com/files/mBT8928I.webp',
        'https://api.imghippo.com/files/uV5779NE.webp',
        'https://api.imghippo.com/files/wdgF7812gz.webp',
        'https://api.imghippo.com/files/HgWv5913es.webp'
        // Add more frame URLs as needed
    ];
    
    let currentFrame = 0;
    const favicon = document.getElementById('animatedFavicon');
    
    // Function to rotate through frames
    function rotateFavicon() {
        if (frameUrls.length > 0) {
            favicon.href = frameUrls[currentFrame];
            currentFrame = (currentFrame + 1) % frameUrls.length;
        }
    }
    
    // Start animation (change frame every 500ms)
    if (frameUrls.length > 1) {
        setInterval(rotateFavicon, 100);
    } else if (frameUrls.length === 1) {
        // If only one frame, just set it once
        favicon.href = frameUrls[0];
    }
}

// Initialize animated favicon when page loads
document.addEventListener('DOMContentLoaded', function() {
    createAnimatedFavicon();
});
// ========== COMMON UTILITY FUNCTIONS ==========
const utils = {
    showFileInfo(fileInput, fileInfoId) {
        const file = fileInput.files[0];
        if (!file) return;
        const fileInfo = document.getElementById(fileInfoId);
        const fileSize = (file.size / 1024).toFixed(2);
        fileInfo.innerHTML = `<div class="d-flex justify-content-between"><span><strong>Name:</strong> ${file.name}</span><span><strong>Size:</strong> ${fileSize} KB</span></div><div><strong>Type:</strong> ${file.type || "Unknown"}</div>`;
        fileInfo.style.display = "block";
    },

    showProgress(progressId, progressTextId, message = "Processing...") {
        const progressContainer = document.getElementById(progressId);
        const progressText = document.getElementById(progressTextId);
        progressContainer.style.display = "block";
        progressText.textContent = message;
        const progressBar = progressContainer.querySelector(".progress-bar");
        progressBar.style.width = "0%";
        let progress = 0;
        const interval = setInterval(() => {
            if (progress >= 90) clearInterval(interval);
            progress += 5;
            progressBar.style.width = progress + "%";
        }, 100);
        return interval;
    },

    hideProgress(progressId, interval) {
        clearInterval(interval);
        const progressContainer = document.getElementById(progressId);
        const progressBar = progressContainer.querySelector(".progress-bar");
        progressBar.style.width = "100%";
        setTimeout(() => { progressContainer.style.display = "none"; }, 500);
    },

    showNotification(message, type = "info") {
        document.querySelectorAll('.notification').forEach(el => el.remove());
        const alertClass = type === "error" ? "danger" : type;
        const icon = type === "success" ? "fa-check" : type === "warning" ? "fa-exclamation-triangle" : "fa-info-circle";
        const notification = document.createElement("div");
        notification.className = `notification alert alert-${alertClass} fade show`;
        notification.innerHTML = `<div class="d-flex justify-content-between align-items-center"><span><i class="fas ${icon} me-2"></i>${message}</span><button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>`;
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 3000);
    },

    copyToClipboard(elementId) {
        const element = document.getElementById(elementId);
        const text = element.value || element.textContent;
        if (text?.trim()) {
            navigator.clipboard.writeText(text).then(() => {
                this.showNotification("Code copied to clipboard!", "success");
            }).catch(() => {
                this.showNotification("Failed to copy text. Please try again.", "error");
            });
        } else {
            this.showNotification("No content to copy!", "warning");
        }
    }
};

// Initialize file input listeners
document.addEventListener("DOMContentLoaded", function() {
    const fileInputs = [
        { id: "courseFileInput", infoId: "courseFileInfo" },
        { id: "blogFileInput", infoId: "blogFileInfo" },
        { id: "glossaryFileInput", infoId: "glossaryFileInfo" },
        { id: "resourceFileInput", infoId: "resourceFileInfo" }
    ];
    
    fileInputs.forEach(({id, infoId}) => {
        document.getElementById(id).addEventListener("change", function() {
            utils.showFileInfo(this, infoId);
        });
    });
});

// ========== BLOG CONTENT GENERATOR ==========
// Blog data storage
let blogData = {
    title: "",
    content: [],
    imageCount: 0,
    fileProcessed: false
};

// Blog processing functions
function uploadBlogFile() {
    const file = document.getElementById("blogFileInput").files[0];
    if (!file) {
        utils.showNotification("Please select a file to upload.", "warning");
        return;
    }
    
    const progressInterval = utils.showProgress("blogProgress", "blogProgressText", "Reading DOCX file...");
    const reader = new FileReader();
    
    reader.onload = (event) => {
        document.getElementById("blogProgressText").textContent = "Converting DOCX to HTML...";
        mammoth.convertToHtml({arrayBuffer: event.target.result})
            .then(result => {
                document.getElementById("blogProgressText").textContent = "Extracting blog content...";
                extractBlogContent(result.value, progressInterval);
            })
            .catch(error => {
                console.error("Conversion error:", error);
                utils.hideProgress("blogProgress", progressInterval);
                utils.showNotification("Error reading the file. Please try again.", "error");
            });
    };
    
    reader.onerror = () => {
        utils.hideProgress("blogProgress", progressInterval);
        utils.showNotification("Error reading the file. Please try again.", "error");
    };
    
    reader.readAsArrayBuffer(file);
}

function extractBlogContent(html, progressInterval) {
    try {
        const tempDiv = document.createElement("div");
        tempDiv.innerHTML = html;
        
        blogData = {
            title: "",
            content: [],
            imageCount: 0,
            fileProcessed: false
        };
        
        // Clean up the HTML - remove unnecessary tags and styles
        cleanHTML(tempDiv);
        
        // Extract title (first H1)
        extractTitle(tempDiv);
        
        // Process all elements to create structured content
        processContentElements(tempDiv);
        
        blogData.fileProcessed = true;
        utils.hideProgress("blogProgress", progressInterval);
        
        // Show image input fields if images were detected
        if (blogData.imageCount > 0) {
            document.getElementById("imageInputsContainer").style.display = "block";
            createImageInputs();
            utils.showNotification(`Blog content extracted successfully! Found ${blogData.imageCount} image placeholders.`, "success");
        } else {
            document.getElementById("imageInputsContainer").style.display = "none";
            utils.showNotification("Blog content extracted successfully! No images detected.", "success");
        }
        
    } catch (error) {
        console.error("Extraction error:", error);
        utils.hideProgress("blogProgress", progressInterval);
        utils.showNotification("Error extracting content. Please check the file format.", "error");
    }
}

function cleanHTML(element) {
    // Remove all style attributes
    const styledElements = element.querySelectorAll('*[style]');
    styledElements.forEach(el => {
        el.removeAttribute('style');
    });
    
    // Remove span tags but keep their content
    const spanElements = element.querySelectorAll('span');
    spanElements.forEach(span => {
        const parent = span.parentNode;
        while (span.firstChild) {
            parent.insertBefore(span.firstChild, span);
        }
        parent.removeChild(span);
    });
    
    // Remove excessive <br> tags
    const brTags = element.querySelectorAll('br');
    let previousWasBr = false;
    brTags.forEach(br => {
        if (previousWasBr) {
            br.remove();
        }
        previousWasBr = true;
    });
    
    // Remove empty elements
    const allElements = element.querySelectorAll('*');
    allElements.forEach(el => {
        if (!el.textContent.trim() && el.children.length === 0 && el.tagName !== 'IMG') {
            el.remove();
        }
    });
}

function extractTitle(element) {
    // Try to find H1 first
    const h1Element = element.querySelector("h1");
    if (h1Element) {
        blogData.title = h1Element.textContent.trim();
        h1Element.remove();
        return;
    }
    
    // If no H1, look for the first significant paragraph
    const paragraphs = element.querySelectorAll("p");
    for (const p of paragraphs) {
        const text = p.textContent.trim();
        if (text && text.length > 10 && text.length < 200) {
            blogData.title = text;
            p.remove();
            return;
        }
    }
    
    // Fallback: use first non-empty text content
    const allElements = element.querySelectorAll('*');
    for (const el of allElements) {
        const text = el.textContent.trim();
        if (text && text.length > 5) {
            blogData.title = text.split('.')[0]; // Take first sentence
            return;
        }
    }
}

function processContentElements(element) {
    const elements = Array.from(element.children);
    
    for (const el of elements) {
        if (!el.textContent || !el.textContent.trim()) continue;
        
        const tagName = el.tagName.toLowerCase();
        const textContent = el.textContent.trim();
        
        // Skip the title if it appears again in the content
        if (textContent === blogData.title) continue;
        
        // Skip metadata paragraphs
        if (tagName === 'p' && shouldSkipParagraph(textContent)) {
            continue;
        }
        
        // Handle headings
        if (tagName.match(/^h[1-6]$/)) {
            const headingLevel = parseInt(tagName.charAt(1));
            blogData.content.push({
                type: 'heading',
                level: headingLevel,
                content: cleanTextContent(el.innerHTML.trim())
            });
        } 
        // Handle paragraphs - check for Introduction
        else if (tagName === 'p' && textContent.length > 0) {
            processParagraph(el, textContent);
        }
        // Handle lists
        else if (tagName === 'ul' || tagName === 'ol') {
            blogData.content.push({
                type: 'list',
                ordered: tagName === 'ol',
                items: Array.from(el.querySelectorAll('li')).map(li => cleanTextContent(li.innerHTML.trim()))
            });
        }
        // Handle images
        else if (tagName === 'img') {
            blogData.imageCount++;
            blogData.content.push({
                type: 'image',
                alt: el.getAttribute('alt') || `Blog image ${blogData.imageCount}`,
                placeholder: `[Image ${blogData.imageCount}]`
            });
        }
        // Handle divs and other containers - recursively process their children
        else if (el.children.length > 0) {
            processChildElements(el);
        }
    }
}

function processParagraph(element, textContent) {
    // Check if this paragraph starts with "Introduction:"
    if (textContent.toLowerCase().startsWith('introduction:')) {
        // Add H2 heading for Introduction
        blogData.content.push({
            type: 'heading',
            level: 2,
            content: 'Introduction'
        });
        
        // Extract the content after "Introduction:"
        const introContent = textContent.substring('introduction:'.length).trim();
        
        // If there's content after "Introduction:", add it as a paragraph
        if (introContent) {
            blogData.content.push({
                type: 'paragraph',
                content: introContent
            });
        }
    } else {
        // Regular paragraph
        blogData.content.push({
            type: 'paragraph',
            content: cleanTextContent(element.innerHTML.trim())
        });
    }
}

// Function to check if paragraph should be skipped
function shouldSkipParagraph(text) {
    const skipKeywords = [
        'link:',
        'alt text:',
        'title text:',
        'meta description:',
        'slug:',
        'relevant courses:',
        'category:'
    ];
    
    const lowerText = text.toLowerCase();
    return skipKeywords.some(keyword => lowerText.startsWith(keyword));
}

function processChildElements(parentElement) {
    const children = Array.from(parentElement.children);
    children.forEach(child => {
        const textContent = child.textContent.trim();
        if (!textContent) return;
        
        const tagName = child.tagName.toLowerCase();
        
        // Skip metadata paragraphs
        if (tagName === 'p' && shouldSkipParagraph(textContent)) {
            return;
        }
        
        if (tagName === 'p') {
            processParagraph(child, textContent);
        } else if (tagName === 'ul' || tagName === 'ol') {
            blogData.content.push({
                type: 'list',
                ordered: tagName === 'ol',
                items: Array.from(child.querySelectorAll('li')).map(li => cleanTextContent(li.innerHTML.trim()))
            });
        } else if (tagName === 'img') {
            blogData.imageCount++;
            blogData.content.push({
                type: 'image',
                alt: child.getAttribute('alt') || `Blog image ${blogData.imageCount}`,
                placeholder: `[Image ${blogData.imageCount}]`
            });
        }
        // Recursively process nested elements
        else if (child.children.length > 0) {
            processChildElements(child);
        }
    });
}

function cleanTextContent(content) {
    // Remove any remaining style attributes and span tags
    return content
        .replace(/<br\s*\/?>/gi, ' ') // Convert br to space
        .replace(/<span[^>]*>/gi, '') // Remove opening span tags
        .replace(/<\/span>/gi, '') // Remove closing span tags
        .replace(/\s+/g, ' ') // Normalize whitespace
        .trim();
}

function createImageInputs() {
    const container = document.getElementById("imageInputs");
    container.innerHTML = "";
    
    for (let i = 1; i <= blogData.imageCount; i++) {
        const inputGroup = document.createElement("div");
        inputGroup.className = "image-input-group";
        inputGroup.innerHTML = `
            <label class="form-label text-light">Image ${i} URL:</label>
            <input type="text" class="form-control image-url-input" id="imageUrl${i}" 
                   placeholder="https://example.com/image${i}.jpg" data-index="${i}">
        `;
        container.appendChild(inputGroup);
    }
}

function addImageInput() {
    blogData.imageCount++;
    const container = document.getElementById("imageInputs");
    const inputGroup = document.createElement("div");
    inputGroup.className = "image-input-group";
    inputGroup.innerHTML = `
        <label class="form-label text-light">Image ${blogData.imageCount} URL:</label>
        <input type="text" class="form-control image-url-input" id="imageUrl${blogData.imageCount}" 
               placeholder="https://example.com/image${blogData.imageCount}.jpg" data-index="${blogData.imageCount}">
    `;
    container.appendChild(inputGroup);
}

function generateBlogCode() {
    if (!blogData.fileProcessed) {
        utils.showNotification("Please upload and process a DOCX file first.", "warning");
        return;
    }

    // Get featured image data from the input fields
    const featuredImageUrl = document.getElementById("featuredImageUrl").value.trim();
    const featuredImageAlt = document.getElementById("featuredImageAlt").value.trim();
    const featuredImageTitle = document.getElementById("featuredImageTitle").value.trim();

    // Collect image URLs for content images
    const imageUrls = [];
    const imageInputs = document.querySelectorAll('.image-url-input');
    imageInputs.forEach(input => {
        if (input.value.trim()) {
            const index = parseInt(input.getAttribute('data-index')) - 1;
            imageUrls[index] = input.value.trim();
        }
    });
    
    let imageIndex = 0;
    let blogHTML = "";
    
    // Add title as H1 with text-center class
    if (blogData.title) {
        blogHTML += `<h1 class="text-center">${blogData.title}</h1>\n\n`;
    }
    
    // ALWAYS add featured image after H1 (even if empty)
    let imgTag = `<img`;
    if (featuredImageUrl) imgTag += ` src="${featuredImageUrl}"`;
    if (featuredImageAlt) imgTag += ` alt="${featuredImageAlt}"`;
    if (featuredImageTitle) imgTag += ` title="${featuredImageTitle}"`;
    imgTag += ` class="img-fluid">\n\n`;
    blogHTML += imgTag;
    
    // Process content
    for (const item of blogData.content) {
        switch (item.type) {
            case 'heading':
                // Add text-center class only to H1 headings
                if (item.level === 1) {
                    blogHTML += `<h${item.level} class="text-center">${item.content}</h${item.level}>\n\n`;
                } else {
                    blogHTML += `<h${item.level}>${item.content}</h${item.level}>\n\n`;
                }
                break;
                
            case 'paragraph':
                // Only add paragraph if it has meaningful content
                const cleanContent = item.content.replace(/<[^>]*>/g, '').trim();
                if (cleanContent && cleanContent.length > 10) {
                    blogHTML += `<p>${item.content}</p>\n\n`;
                }
                break;
                
            case 'list':
                const tag = item.ordered ? 'ol' : 'ul';
                blogHTML += `<${tag}>\n`;
                item.items.forEach(listItem => {
                    blogHTML += `  <li>${listItem}</li>\n`;
                });
                blogHTML += `</${tag}>\n\n`;
                break;
                
            case 'image':
                const imageUrl = imageUrls[imageIndex] || "#";
                blogHTML += `<img src="${imageUrl}" alt="${item.alt}" class="img-fluid">\n\n`;
                imageIndex++;
                break;
        }
    }
    
    // Set the blog code
    document.getElementById("blogCode").value = blogHTML;
    document.getElementById("blogPreview").innerHTML = blogHTML;
    utils.showNotification("Blog code generated successfully!", "success");
}

// ========== COURSE CONTENT GENERATOR ==========
const courseData = { 
    overview: "", courseObjectives: "", syllabus: "", courseTitle: "", faqData: [],
    overviewSections: [], courseObjectivesList: [], syllabusModules: [], courseObjectivesIntro: "",
    fileProcessed: false
};

function uploadCourseFile() {
    const file = document.getElementById("courseFileInput").files[0];
    const courseName = document.getElementById("courseNameInput").value.trim();
    
    if (!file) return utils.showNotification("Please select a file to upload.", "warning");
    if (!courseName) return utils.showNotification("Please enter a course name.", "warning");
    
    courseData.courseTitle = courseName;
    const progressInterval = utils.showProgress("courseProgress", "courseProgressText", "Reading DOCX file...");
    const reader = new FileReader();
    
    reader.onload = (event) => {
        document.getElementById("courseProgressText").textContent = "Converting DOCX to HTML...";
        mammoth.convertToHtml({arrayBuffer: event.target.result})
            .then(result => {
                document.getElementById("courseProgressText").textContent = "Extracting course content...";
                extractCourseContent(result.value, progressInterval);
            })
            .catch(error => {
                console.error("Conversion error:", error);
                utils.hideProgress("courseProgress", progressInterval);
                utils.showNotification("Error reading the file. Please try again.", "error");
            });
    };
    
    reader.onerror = () => {
        utils.hideProgress("courseProgress", progressInterval);
        utils.showNotification("Error reading the file. Please try again.", "error");
    };
    
    reader.readAsArrayBuffer(file);
}

function extractCourseContent(html, progressInterval) {
    try {
        const tempDiv = document.createElement("div");
        tempDiv.innerHTML = html;
        
        courseData.overviewSections = [];
        courseData.courseObjectivesList = [];
        courseData.syllabusModules = [];
        courseData.courseObjectivesIntro = "";
        courseData.faqData = [];
        
        const elementsArray = Array.from(tempDiv.children);
        
        // Extract all content sections
        extractOverview(elementsArray);
        extractCourseObjectives(elementsArray);
        extractSyllabus(elementsArray);
        extractFAQContent(elementsArray);
        
        courseData.fileProcessed = true;
        utils.hideProgress("courseProgress", progressInterval);
        utils.showNotification("Course content extracted successfully!", "success");
        
    } catch (error) {
        console.error("Extraction error:", error);
        utils.hideProgress("courseProgress", progressInterval);
        utils.showNotification("Error extracting content. Please check the file format.", "error");
    }
}

function extractOverview(elementsArray) {
    let overviewStart = -1;
    elementsArray.forEach((element, i) => {
        const text = element.textContent.trim().toLowerCase();
        if (text.includes("overview") && overviewStart === -1) overviewStart = i;
    });
    
    if (overviewStart !== -1) {
        const syllabusStart = elementsArray.findIndex(el => 
            el.textContent.trim().toLowerCase().includes("syllabus") || 
            el.textContent.trim().toLowerCase().includes("course syllabus")
        );
        const overviewEnd = syllabusStart !== -1 ? syllabusStart : elementsArray.length;
        const overviewElements = elementsArray.slice(overviewStart + 1, overviewEnd);
        courseData.overview = overviewElements.map(el => el.outerHTML).join("");
        courseData.overviewSections = [{ heading: "Overview", content: courseData.overview }];
    }
}

function extractCourseObjectives(elementsArray) {
    const syllabusStart = elementsArray.findIndex(el => 
        el.textContent.trim().toLowerCase().includes("syllabus")
    );
    
    if (syllabusStart !== -1) {
        const syllabusElements = elementsArray.slice(syllabusStart);
        
        // Find course objectives intro
        let foundSyllabusHeading = false;
        for (const element of syllabusElements) {
            const text = element.textContent.trim();
            if (text.toLowerCase().includes("syllabus")) {
                foundSyllabusHeading = true;
                continue;
            }
            if (foundSyllabusHeading && element.tagName === 'P') {
                courseData.courseObjectivesIntro = element.innerHTML.trim();
                break;
            }
        }
        
        // Extract course objectives list
        let inObjectives = false;
        for (const element of syllabusElements) {
            const text = element.textContent.trim().toLowerCase();
            if (text.includes("course objectives")) {
                inObjectives = true;
                continue;
            }
            if (inObjectives && element.tagName === 'UL') {
                const items = element.querySelectorAll('li');
                items.forEach(item => {
                    const itemText = item.innerHTML.trim();
                    if (!isUnwantedObjective(itemText)) {
                        courseData.courseObjectivesList.push(itemText);
                    }
                });
                break;
            }
        }
    }
}

function extractSyllabus(elementsArray) {
    courseData.syllabusModules = extractAllSyllabusContent(elementsArray);
}

function extractFAQContent(elementsArray) {
    let faqStart = -1;
    elementsArray.forEach((element, i) => {
        const text = element.textContent.trim().toLowerCase();
        if ((text.includes("faq") || text.includes("frequently asked questions")) && faqStart === -1) {
            faqStart = i;
        }
    });
    
    if (faqStart !== -1) {
        let currentQuestion = "", currentAnswer = "", inFAQSection = false;
        
        for (let i = faqStart; i < elementsArray.length; i++) {
            const element = elementsArray[i];
            const text = element.textContent.trim();
            
            if (i > faqStart && (text.toLowerCase().includes("glossary") || text.toLowerCase().includes("resources"))) {
                break;
            }
            
            if (text.toLowerCase().includes("faq") || text.toLowerCase().includes("frequently asked questions")) {
                inFAQSection = true;
                continue;
            }
            
            if (inFAQSection) {
                const isQuestion = element.tagName.match(/^H[1-6]$/i) || 
                                 element.innerHTML.includes('<strong>') || 
                                 element.innerHTML.includes('<b>') ||
                                 text.endsWith('?');
                
                if (isQuestion) {
                    if (currentQuestion && currentAnswer) {
                        courseData.faqData.push({
                            question: currentQuestion.trim(),
                            answer: currentAnswer.trim()
                        });
                        currentAnswer = "";
                    }
                    currentQuestion = text;
                } else if (currentQuestion && text) {
                    currentAnswer += (currentAnswer ? " " : "") + element.outerHTML;
                }
            }
        }
        
        if (currentQuestion && currentAnswer) {
            courseData.faqData.push({
                question: currentQuestion.trim(),
                answer: currentAnswer.trim()
            });
        }
    }
}

function isUnwantedObjective(itemText) {
    const unwantedPatterns = [
        "identify various categories", "assessing weather", "maintaining compliance", 
        "safely integrating hoists", "individuals who are appointed", "employees charged with checking", 
        "safety officers", "employees who want advanced training", "how to identify", 
        "methods for assessing", "techniques for maintaining", "methods for safely integrating", 
        "who should enroll"
    ];
    const lowerItem = itemText.toLowerCase();
    return unwantedPatterns.some(pattern => lowerItem.includes(pattern));
}

function extractAllSyllabusContent(elementsArray) {
    const modules = [];
    let currentModule = null;
    
    for (let i = 0; i < elementsArray.length; i++) {
        const element = elementsArray[i];
        const text = element.textContent.trim();
        if (!text) continue;
        
        if (text.match(/^Module\s*\d+:/i)) {
            if (currentModule) modules.push(currentModule);
            
            currentModule = {
                title: text,
                description: "",
                lessons: []
            };
            
            for (let j = i + 1; j < Math.min(i + 5, elementsArray.length); j++) {
                const nextElement = elementsArray[j];
                const nextText = nextElement.textContent.trim();
                
                if (nextElement.tagName === 'P' && nextText && 
                    !nextText.match(/^Module\s*\d+:/i) && 
                    !nextText.match(/^Lesson\s*\d+:/i) &&
                    !nextText.includes("LESSONS") &&
                    !nextText.includes("Course Content")) {
                    currentModule.description = nextText;
                    break;
                }
            }
        }
        else if (element.tagName === 'UL' && currentModule) {
            const listItems = element.querySelectorAll('li');
            let currentLesson = null;
            
            for (const item of listItems) {
                const itemText = item.textContent.trim();
                const itemHTML = item.innerHTML.trim();
                
                if (itemText.match(/^Lesson\s*\d+:/i)) {
                    if (currentLesson) {
                        if (!currentLesson.items.some(item => item.toLowerCase().includes("lesson quiz"))) {
                            currentLesson.items.push("Lesson quiz.");
                        }
                        currentModule.lessons.push(currentLesson);
                    }
                    
                    currentLesson = {
                        title: itemText,
                        items: []
                    };
                    
                    const nestedList = item.querySelector('ul');
                    if (nestedList) {
                        const nestedItems = nestedList.querySelectorAll('li');
                        nestedItems.forEach(nestedItem => {
                            const nestedText = nestedItem.innerHTML.trim();
                            if (nestedText && !nestedText.match(/^Lesson\s*\d+:/i)) {
                                currentLesson.items.push(nestedText);
                            }
                        });
                    }
                }
                else if (currentLesson && itemText && !itemText.match(/^Lesson\s*\d+:/i)) {
                    currentLesson.items.push(itemHTML);
                }
            }
            
            if (currentLesson) {
                if (!currentLesson.items.some(item => item.toLowerCase().includes("lesson quiz"))) {
                    currentLesson.items.push("Lesson quiz.");
                }
                currentModule.lessons.push(currentLesson);
            }
        }
    }
    
    if (currentModule) modules.push(currentModule);
    return modules;
}

function generateOverviewCode() {
    if (!courseData.fileProcessed) return utils.showNotification("Please upload and process a DOCX file first.", "warning");
    
    const videoHtml = `<!-- <div class="col-md-5 col-sm-12 elementor-col-40 elementor-column ml-md-3 p-0 pb-0 pt-0 verified-field-container" style="float:right"><div class="demo-video"><iframe title="${courseData.courseTitle || 'Course Video'}" src="https://player.vimeo.com/video/680313019?h=6c9335ab94" width="560" height="200" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen data-ready="true"></iframe><img src="" alt="${courseData.courseTitle || 'Course Name'}"></div></div> -->`;
    
    let contentHtml = "";
    if (courseData.overviewSections.length > 0) {
        courseData.overviewSections.forEach(section => {
            const tempDiv = document.createElement("div");
            tempDiv.innerHTML = section.content;
            tempDiv.querySelectorAll("h1, h2, h3, h4, h5, h6").forEach(heading => {
                const newHeading = document.createElement("h2");
                newHeading.className = "fs-4 text-warning";
                newHeading.innerHTML = heading.innerHTML;
                heading.parentNode.replaceChild(newHeading, heading);
            });
            tempDiv.querySelectorAll("ul, ol").forEach(list => { list.className = "objective-tab-list"; });
            tempDiv.querySelectorAll("a").forEach(link => { link.setAttribute("target", "_blank"); });
            contentHtml += tempDiv.innerHTML;
        });
    } else {
        contentHtml = "<p>No overview content found.</p>";
    }
    
    const overviewHtml = videoHtml + contentHtml;
    document.getElementById("overviewCode").value = overviewHtml;
    document.getElementById("coursePreview").innerHTML = overviewHtml;
    utils.showNotification("Overview code generated successfully!", "success");
}

function generateCourseObjectivesCode() {
    if (!courseData.fileProcessed) return utils.showNotification("Please upload and process a DOCX file first.", "warning");
    
    const introParagraph = courseData.courseObjectivesIntro || `This ${courseData.courseTitle || 'Course'} will equip workers with the information and authority required.`;
    let listItemsHtml = "";
    
    if (courseData.courseObjectivesList.length > 0) {
        listItemsHtml = courseData.courseObjectivesList.map(item => `<li>${item}</li>`).join('\n');
    } else {
        listItemsHtml = "<li>No course objectives found in the document.</li>";
    }
    
    const courseObjectivesHtml = `<p>${introParagraph}</p><h2 class="h3">Course Objectives</h2><p class="m-0"><b>After completing this course, the learner will be able to:</b></p><ul class="objective-tab-list">${listItemsHtml}</ul>`;
    
    document.getElementById("courseObjectivesCode").value = courseObjectivesHtml;
    document.getElementById("coursePreview").innerHTML = courseObjectivesHtml;
    utils.showNotification("Course Objectives code generated successfully!", "success");
}

function generateSyllabusCode() {
    if (!courseData.fileProcessed) return utils.showNotification("Please upload and process a DOCX file first.", "warning");

    const syllabusHtml = generateSyllabusHTML();
    document.getElementById("syllabusCode").value = syllabusHtml;
    document.getElementById("coursePreview").innerHTML = syllabusHtml;
    utils.showNotification("Syllabus code generated successfully!", "success");
}

function generateFAQCode() {
    if (!courseData.fileProcessed) return utils.showNotification("Please upload and process a DOCX file first.", "warning");
    if (courseData.faqData.length === 0) return utils.showNotification("No FAQ content found in the document.", "warning");

    let faqHTML = `<div class="faq-section">\n`;
    
    courseData.faqData.forEach((faq, index) => {
        faqHTML += `  <div class="faq-item">\n`;
        faqHTML += `    <div class="faq-question">Q: ${faq.question}</div>\n`;
        faqHTML += `    <div class="faq-answer">A: ${faq.answer}</div>\n`;
        faqHTML += `  </div>\n`;
        
        if (index < courseData.faqData.length - 1) {
            faqHTML += `  <hr>\n`;
        }
    });
    
    faqHTML += `</div>`;
    
    document.getElementById("faqCode").value = faqHTML;
    document.getElementById("coursePreview").innerHTML = faqHTML;
    generateIndividualFAQItems();
    utils.showNotification("FAQ code generated successfully!", "success");
}

function generateIndividualFAQItems() {
    const container = document.getElementById("faqItemsContainer");
    container.innerHTML = "";
    
    courseData.faqData.forEach((faq, index) => {
        const faqItem = document.createElement("div");
        faqItem.className = "faq-item mb-4 p-3 border rounded";
        
        faqItem.innerHTML = `
            <div class="mb-3">
                <label class="form-label fw-bold text-warning">Question ${index + 1}:</label>
                <div class="position-relative">
                    <button class="btn btn-sm btn-outline-warning position-absolute top-0 end-0 copy-btn" onclick="copyFAQText('question${index}')">
                        <i class="fas fa-copy"></i>
                    </button>
                    <textarea class="form-control" id="question${index}" rows="2" readonly>${faq.question}</textarea>
                </div>
            </div>
            <div>
                <label class="form-label fw-bold text-info">Answer ${index + 1}:</label>
                <div class="position-relative">
                    <button class="btn btn-sm btn-outline-info position-absolute top-0 end-0 copy-btn" onclick="copyFAQText('answer${index}')">
                        <i class="fas fa-copy"></i>
                    </button>
                    <textarea class="form-control" id="answer${index}" rows="4" readonly>${faq.answer}</textarea>
                </div>
            </div>
        `;
        
        container.appendChild(faqItem);
    });
    
    document.getElementById("faqIndividualItems").style.display = "block";
}

function copyFAQText(elementId) {
    const element = document.getElementById(elementId);
    if (element) {
        element.select();
        navigator.clipboard.writeText(element.value).then(() => {
            utils.showNotification("Text copied to clipboard!", "success");
        }).catch(() => {
            utils.showNotification("Failed to copy text.", "error");
        });
    }
}

function debugExtraction() {
    if (!courseData.fileProcessed) return utils.showNotification("Please upload and process a DOCX file first.", "warning");
    
    let debugInfo = `
        <h3>Debug Information</h3>
        <h4>Course Title: ${courseData.courseTitle || 'Not found'}</h4>
        <h4>Overview Sections: ${courseData.overviewSections.length}</h4>
        <h4>Course Objectives: ${courseData.courseObjectivesList.length}</h4>
        <h4>Syllabus Modules: ${courseData.syllabusModules.length}</h4>
        <h4>FAQ Items: ${courseData.faqData.length}</h4>
        <hr>
    `;
    
    if (courseData.syllabusModules.length > 0) {
        debugInfo += '<h4>Modules Details:</h4>';
        courseData.syllabusModules.forEach((module, index) => {
            debugInfo += `
                <div style="border: 1px solid #ccc; margin: 10px 0; padding: 10px;">
                    <h5>Module ${index + 1}: ${module.title}</h5>
                    <p><strong>Description:</strong> ${module.description || 'No description'}</p>
                    <p><strong>Lessons:</strong> ${module.lessons.length}</p>
            `;
            
            module.lessons.forEach((lesson, lessonIndex) => {
                debugInfo += `
                    <div style="margin-left: 20px; border-left: 2px solid #007bff; padding-left: 10px; margin: 10px 0;">
                        <h6>Lesson ${lessonIndex + 1}: ${lesson.title}</h6>
                        <p><strong>Items:</strong> ${lesson.items.length}</p>
                        <ul>
                `;
                lesson.items.forEach((item, itemIndex) => {
                    debugInfo += `<li>${itemIndex + 1}. ${item.substring(0, 100)}${item.length > 100 ? '...' : ''}</li>`;
                });
                debugInfo += '</ul></div>';
            });
            debugInfo += '</div>';
        });
    } else {
        debugInfo += '<p>No modules found. Check the document structure.</p>';
    }
    
    document.getElementById("coursePreview").innerHTML = debugInfo;
    utils.showNotification("Debug information displayed in preview area", "info");
}

function generateSyllabusHTML() {
    let totalLessons = 0;
    let modulesHTML = '';
    
    if (courseData.syllabusModules.length > 0) {
        courseData.syllabusModules.forEach((module, moduleIndex) => {
            totalLessons += module.lessons.length;
            let lessonsHTML = '';
            
            module.lessons.forEach((lesson, lessonIndex) => {
                let lessonItemsHTML = '';
                if (lesson.items && lesson.items.length > 0) {
                    lessonItemsHTML = lesson.items.map(item => {
                        const cleanItem = item.replace(/\s+/g, ' ').trim();
                        return `<li>${cleanItem}</li>`;
                    }).join('');
                } else {
                    lessonItemsHTML = '<li>No content available for this lesson.</li>';
                }
                
                lessonsHTML += `
                    <li>
                        <b>${lesson.title}</b>
                        <ul class="objective-tab-list">
                            ${lessonItemsHTML}
                        </ul>
                    </li>`;
            });

            modulesHTML += `
                <div class="sbox">
                    <h4 class="h6 fw-normal font-poppins"><strong>${module.title}</strong></h4>
                    <hr class="border-3 my-2" style="background: #ffcd05;opacity: 1;padding: 2px;">
                    ${module.description ? `<p class="pl-3">${module.description}</p>` : ''}
                    <ul>
                        ${lessonsHTML}
                    </ul>
                </div>`;
        });
    } else {
        modulesHTML = '<div class="sbox"><p>No syllabus content could be extracted. Please check the document structure.</p></div>';
    }

    const courseTitle = courseData.courseTitle || 'Course';
    const syllabusTitle = `${courseTitle} Syllabus`;
    
    return `<style>
        .sbox {
            margin: 10px 0;
            border: 1px solid #f5f5f5;
            background: #fff;
            padding: 10px 18px;
            box-shadow: 0 0 0px 1px rgba(20,23,28,.1), 0 3px 1px 0 rgba(20,23,28,.1);
            color: #000;
        }
        </style>
        <h2 class="font-poppins fw-bold fs-6"><strong>${courseTitle} Course Syllabus</strong></h2>
        <p>This ${courseTitle} course consists of ${totalLessons} lessons divided into ${courseData.syllabusModules.length} modules. Students are required to complete each lesson in the sequence listed below.</p>
        <div class="h3 font-poppins">Course Content</div>
        <div style="background: #f2f3f5;padding-bottom:1px;">
            <div class="border-0 pl-3 sbox" style="background-color: #ffcd05;">
                <div class="fs-6 fw-normal lh-sm m-0 text-uppercase"><strong>Lessons</strong></div>
            </div>
            <h3 class="font-poppins fs-6 fw-normal pl-3 sbox"><strong>Introduction</strong></h3>
            ${modulesHTML}
            <div class="sbox">
                <h4 class="font-poppins fs-5 m-0 fw-normal"><strong>Final Examination</strong></h4>
            </div>
        </div>`;
}

function downloadDemoFile(){
    const a=document.createElement('a');
    a.style.display='none';
    a.href='https://staging-media.hazwoper-osha.com/wp-content/uploads/2025/10/1759820370/demo-file-of-website-content-for-3-section.docx';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a)
}

// ========== GLOSSARY GENERATOR FUNCTIONS ==========
function uploadGlossaryFile() {
    const file = document.getElementById("glossaryFileInput").files[0];
    if (!file) return void utils.showNotification("Please select a file to upload.", "warning");
    const progressInterval = utils.showProgress("glossaryProgress", "glossaryProgressText", "Reading DOCX file...");
    const reader = new FileReader();
    reader.onload = function(e) {
        const arrayBuffer = e.target.result;
        document.getElementById("glossaryProgressText").textContent = "Converting DOCX to HTML...";
        mammoth.convertToHtml({arrayBuffer: arrayBuffer}).then(result => {
            const html = result.value;
            document.getElementById("glossaryProgressText").textContent = "Parsing glossary data...";
            parseGlossaryData(html, progressInterval);
        }).catch(e => {
            console.error(e);
            utils.hideProgress("glossaryProgress", progressInterval);
            utils.showNotification("Error reading the file. Please try again.", "error");
        });
    };
    reader.onerror = function() {
        utils.hideProgress("glossaryProgress", progressInterval);
        utils.showNotification("Error reading the file. Please try again.", "error");
    };
    reader.readAsArrayBuffer(file);
}

function parseGlossaryData(html, progressInterval) {
    try {
        const tempDiv = document.createElement("div");
        tempDiv.innerHTML = html;
        const glossaryData = [];
        const tables = tempDiv.getElementsByTagName("table");
        if (!(tables.length > 0)) return utils.hideProgress("glossaryProgress", progressInterval), void utils.showNotification("No tables found in the document.", "warning");
        {
            const rows = tables[0].getElementsByTagName("tr");
            for (let i = 1; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName("td");
                if (2 === cells.length) {
                    const term = cells[0].innerText.trim();
                    const definition = cells[1].innerHTML.trim();
                    term && definition && glossaryData.push({term: term, definition: definition});
                }
            }
        }
        0 === glossaryData.length ? (utils.hideProgress("glossaryProgress", progressInterval), utils.showNotification("No glossary terms found.", "warning")) : (localStorage.setItem("glossaryData", JSON.stringify(glossaryData)), utils.hideProgress("glossaryProgress", progressInterval), utils.showNotification(`Glossary data extracted successfully! Found ${glossaryData.length} terms.`, "success"));
    } catch (e) {
        console.error("Error parsing glossary data:", e);
        utils.hideProgress("glossaryProgress", progressInterval);
        utils.showNotification("Error parsing glossary data. Please check the file format.", "error");
    }
}

function generateGlossary() {
    const storedData = localStorage.getItem("glossaryData");
    if (storedData) try {
        const glossaryData = JSON.parse(storedData);
        const groupedData = {};
        glossaryData.forEach(item => {
            const term = item.term.trim();
            const definition = item.definition.trim();
            const firstLetter = term.charAt(0).toUpperCase();
            groupedData[firstLetter] || (groupedData[firstLetter] = []);
            groupedData[firstLetter].push({term: term, definition: definition});
        });
        let alphabetButtons = "";
        let glossaryContent = "";
        for (let i = 65; i <= 90; i++) {
            const letter = String.fromCharCode(i);
            alphabetButtons += `<button class="glossaryBtn btn btn-outline-primary m-1 ${"A" === letter ? "active" : ""}" onclick="openItem('${letter}', event)">${letter}</button>\n`;
            glossaryContent += `<div id="${letter}" class="result-container glosary-item" style="display:${"A" === letter ? "block" : "none"};">\n`;
            groupedData[letter]?.length > 0 ? groupedData[letter].forEach(item => {
                glossaryContent += `<h2>${item.term}</h2>\n<div>${item.definition}</div>\n`;
            }) : glossaryContent += `<h2>${letter}</h2><p>No terms found</p>\n`;
            glossaryContent += "</div>\n";
        }
        const glossaryHtml = `
            <style>
                .active.glossaryBtn,
                .glossaryBtn:hover {
                    background: black !important;
                    transform: translateY(-4px) scale(1);
                    transition: 0.2s;
                    color: #ffbf00!important
                }
            </style>
            <div class="custom-glossary">
                <script>
                    function openItem(glossaryItem, evt) {
                        var items = document.getElementsByClassName("result-container");
                        for (var i = 0; i < items.length; i++) {
                            items[i].style.display = "none";
                        }
                        document.getElementById(glossaryItem).style.display = "block";

                        var btns = document.getElementsByClassName("glossaryBtn");
                        for (var j = 0; j < btns.length; j++) {
                            btns[j].classList.remove("active");
                        }
                        evt.target.classList.add("active");
                    }
                <\/script>
                <div class="container">
                    <div class="glossaryBtnMain alphabet-buttons mb-3">
                        ${alphabetButtons}
                    </div>
                    ${glossaryContent}
                </div>
            </div>`;
        document.getElementById("glossaryCode").value = glossaryHtml;
        document.getElementById("glossaryPreview").innerHTML = glossaryHtml;
        utils.showNotification("Glossary code generated successfully!", "success");
    } catch (e) {
        console.error("Error generating glossary:", e);
        utils.showNotification("Error generating glossary. Please try again.", "error");
    } else utils.showNotification("Please upload and parse a DOCX file first.", "warning");
}

// ========== RESOURCE GENERATOR FUNCTIONS ==========
const extractActualUrl = url => url ? "string" == typeof url ? url : url.Target || url.target || url.url || url.href || url.Rel && url.Rel.Target || "" : "";

function normCell(cell) {
    if (!cell) return {text: "", url: "", isHyperlink: false};
    if ("object" == typeof cell && ("v" in cell || "w" in cell || "l" in cell || "t" in cell)) {
        let text = void 0 !== cell.w && null !== cell.w ? cell.w : cell.v;
        "object" == typeof text && (text = cell.w || JSON.stringify(text) || "");
        let url = cell.l || cell.hyperlink || null;
        url = extractActualUrl(url) || (text && (text.startsWith("http") || text.includes("://")) ? text : "");
        return {text: String(null == text ? "" : text).trim(), url: url, isHyperlink: !!cell.l};
    }
    let text = String(cell || "").trim();
    return {text: text, url: text && (text.startsWith("http") || text.includes("://")) ? text : "", isHyperlink: false};
}

function splitMulti(cell) {
    if (!cell) return [];
    if ("object" == typeof cell && cell.l) return [normCell(cell)];
    let text = "object" == typeof cell ? void 0 !== cell.w ? cell.w : cell.v : cell;
    return text = null == text ? "" : String(text), text.trim() ? text.split(/[\n;]+/).map(item => {
        const text = item.trim();
        return {text: text, url: text && (text.startsWith("http") || text.includes("://")) ? text : "", isHyperlink: false};
    }).filter(item => item.text) : [];
}

const pdfHref = pdf => pdf && pdf.url && pdf.url.toString().trim() ? pdf.url : "#";

function linkDisplay(link) {
    if (!link) return "";
    if (link.isHyperlink) return link.text || "";
    try {
        const url = new URL(link.url || link.text);
        const hostname = url.hostname.toLowerCase();
        return hostname.includes("google.com") ? "Google" : hostname.includes("youtube.com") ? "YouTube" : hostname.includes("github.com") ? "GitHub" : url.hostname.replace("www.", "").split(".")[0] || link.text;
    } catch (e) {
        return link.text || "";
    }
}

function processResourceFile() {
    const file = document.getElementById("resourceFileInput").files[0];
    if (!file) return void utils.showNotification("Please select a file to upload.", "warning");
    const progressInterval = utils.showProgress("resourceProgress", "resourceProgressText", "Reading Excel file...");
    const reader = new FileReader();
    reader.onload = e => {
        try {
            document.getElementById("resourceProgressText").textContent = "Processing Excel data...";
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, {type: "array"});
            const worksheet = workbook.Sheets[workbook.SheetNames[0]];
            let mergedCells = {};
            worksheet["!merges"] && worksheet["!merges"].forEach(merge => {
                const startCell = XLSX.utils.encode_cell({r: merge.s.r, c: merge.s.c});
                for (let row = merge.s.r; row <= merge.e.r; ++row) for (let col = merge.s.c; col <= merge.e.c; ++col) {
                    const cell = XLSX.utils.encode_cell({r: row, c: col});
                    mergedCells[cell] = startCell;
                    worksheet[cell] || (worksheet[cell] = {t: "s", v: worksheet[startCell] ? worksheet[startCell].v : ""});
                }
            });
            document.getElementById("resourceProgressText").textContent = "Generating HTML...";
            processSheet(worksheet, mergedCells, progressInterval);
        } catch (e) {
            console.error("Error processing resource file:", e);
            utils.hideProgress("resourceProgress", progressInterval);
            utils.showNotification("Error processing Excel file. Please check the format.", "error");
        }
    };
    reader.onerror = function() {
        utils.hideProgress("resourceProgress", progressInterval);
        utils.showNotification("Error reading the file. Please try again.", "error");
    };
    reader.readAsArrayBuffer(file);
}

function processSheet(worksheet, mergedCells = {}, progressInterval) {
    try {
        const cells = {};
        for (const cell in worksheet) cell.startsWith("!") || (cells[cell] = worksheet[cell]);
        const maxRow = Math.max(...Object.keys(cells).map(cell => XLSX.utils.decode_cell(cell).r));
        const rows = [];
        for (let row = 0; row <= maxRow; row++) {
            const rowData = [];
            for (let col = 0; col < 10; col++) {
                const cellAddress = XLSX.utils.encode_cell({r: row, c: col});
                rowData[col] = cells[cellAddress] || null;
            }
            rows.push(rowData);
        }
        const headerRow = rows.find(row => row.some(cell => cell && "string" == typeof cell.v && cell.v.toLowerCase().includes("title")));
        const headerIndex = headerRow ? rows.indexOf(headerRow) : 0;
        const headers = rows[headerIndex].map(cell => cell ? String(cell.v || "").toLowerCase() : "");
        const moduleCol = headers.findIndex(header => header.includes("module"));
        const titleCol = headers.findIndex(header => header.includes("title"));
        const pdfCol = headers.findIndex(header => header.includes("pdf"));
        const linkCol = headers.findIndex(header => header.includes("link"));
        let titleIndex = -1 === titleCol ? 1 : titleCol;
        let pdfIndex = -1 === pdfCol ? 2 : pdfCol;
        let linkIndex = -1 === linkCol ? 3 : linkCol;
        const dataRows = rows.slice(headerIndex + 1);
        const resources = [];
        const resourceMap = {};
        let currentModule = "";
        let currentTitle = "";
        let glossaryLink = "";
        let tableHTML = '<table class="table table-bordered table-sm"><thead><tr><th>Module</th><th>Title</th><th>PDFs</th><th>Links</th></tr></thead><tbody>';
        for (let i = 0; i < dataRows.length; i++) {
            const row = dataRows[i];
            const moduleCell = moduleCol >= 0 && row[moduleCol] ? normCell(row[moduleCol]).text : "";
            const pdfCell = pdfIndex >= 0 ? XLSX.utils.encode_cell({r: i + headerIndex + 1, c: pdfIndex}) : "";
            const linkCell = linkIndex >= 0 ? XLSX.utils.encode_cell({r: i + headerIndex + 1, c: linkIndex}) : "";
            const isPdfMerged = !pdfCell || !mergedCells[pdfCell] || mergedCells[pdfCell] === pdfCell;
            const isLinkMerged = !linkCell || !mergedCells[linkCell] || mergedCells[linkCell] === linkCell;
            const pdfs = isPdfMerged && pdfIndex >= 0 && row[pdfIndex] ? splitMulti(row[pdfIndex]) : [];
            const links = isLinkMerged && linkIndex >= 0 && row[linkIndex] ? splitMulti(row[linkIndex]) : [];
            let titleCell = titleIndex >= 0 && row[titleIndex] ? normCell(row[titleIndex]).text : "";
            if (!(moduleCell || titleCell || pdfs.length || links.length)) continue;
            if (!moduleCell && titleCell && /^Module\s*\d+:/.test(titleCell)) {
                const moduleMatch = titleCell.match(/^(Module\s*\d+):\s*(.*)/);
                if (moduleMatch) {
                    currentModule = moduleMatch[1] + (moduleMatch[2] ? ": " + moduleMatch[2].trim() : "");
                    tableHTML += `<tr class="table-info"><td colspan="4"><b>${currentModule}</b></td></tr>`;
                    continue;
                }
            }
            if (moduleCell && moduleCell.toLowerCase().includes("glossary") || titleCell && titleCell.toLowerCase().includes("glossary")) {
                glossaryLink = links[0]?.url || pdfs[0]?.url || "#";
                tableHTML += `<tr class="glossary-row"><td colspan="2"><b><i class="fa fa-book"></i> Glossary</b></td><td>${pdfs.map(pdf => pdf.text ? `<a href="${pdf.url || "#"}" target="_blank"><i class="fa fa-file-pdf pdf-color"></i> ${pdf.text}</a>` : "").join("<br>")}</td><td>${links.map(link => `<a href="${link.url || "#"}" target="_blank"><i class="fa fa-link"></i> ${linkDisplay(link)}</a>`).join("<br>")}</td></tr>`;
                continue;
            }
            if (titleCell) {
                if (/^Module\s*\d+:/.test(titleCell)) {
                    const moduleMatch = titleCell.match(/^(Module\s*\d+):/);
                    if (moduleMatch) {
                        currentModule = moduleMatch[1];
                        titleCell = titleCell.replace(/^Module\s*\d+:\s*/, "").trim();
                    }
                }
                currentTitle = titleCell;
                const resourceKey = (currentModule || "") + "||" + currentTitle;
                if (!resourceMap[resourceKey]) {
                    const resource = {module: currentModule || null, title: currentTitle, pdfs: [], links: []};
                    resources.push(resource);
                    resourceMap[resourceKey] = resource;
                }
            } else if (!currentTitle) continue;
            const resource = resourceMap[(currentModule || "") + "||" + currentTitle];
            resource && (pdfs.forEach(pdf => {
                pdf && pdf.text && !resource.pdfs.some(existing => existing.text === pdf.text && (existing.url || "") === (pdf.url || "")) && resource.pdfs.push(pdf);
            }), links.forEach(link => {
                link && link.text && !resource.links.some(existing => existing.text === link.text && (existing.url || "") === (link.url || "")) && resource.links.push(link);
            }));
            const rowClass = 0 === pdfs.length && 0 === links.length ? "bg-gray-300" : "";
            tableHTML += `<tr class="${rowClass}"><td>${currentModule ? currentModule.match(/^(Module\s*\d+)/)?.[1] || currentModule : ""}</td><td>${currentTitle || ""}</td><td>${pdfs.map(pdf => pdf.text ? `<a href="${pdf.url || "#"}" target="_blank"><i class="fa fa-file-pdf pdf-color"></i> ${pdf.text}</a>` : "").join("<br>")}</td><td>${links.map(link => `<a href="${link.url || "#"}" target="_blank"><i class="fa fa-link"></i> ${linkDisplay(link)}</a>`).join("<br>")}</td></tr>`;
        }
        tableHTML += "</tbody></table>";
        document.getElementById("resourcePreview").innerHTML = tableHTML;
        const filteredResources = resources.filter(resource => resource.pdfs && resource.pdfs.length || resource.links && resource.links.length);
        document.getElementById("htmlOutput").value = generateResourceHTML(glossaryLink || "#", filteredResources);
        utils.hideProgress("resourceProgress", progressInterval);
        utils.showNotification(`Resource HTML generated successfully! Processed ${filteredResources.length} resources.`, "success");
    } catch (e) {
        console.error("Error processing sheet:", e);
        utils.hideProgress("resourceProgress", progressInterval);
        utils.showNotification("Error processing Excel data. Please check the file format.", "error");
    }
}

function generateResourceHTML(glossaryLink, resources) {
    let html = `<style>.bg-black.rounded-md.shadow-md:hover {border-left: 4px solid #000;transform: translate(2px);transition: .1s;}.bg-yellow-400.rounded-md.shadow-md:hover {border-left: 4px solid #ffc107;transform: translate(2px);transition: .1s;}</style><div class="bg-black rounded-md shadow-md"><div class="rounded-sm bg-yellow-400 my-4 p-3 w-full"><h2 class="text-2xl leading-none m-0 flex items-center space-x-2"><i class="fa fa-book"></i><a href="${glossaryLink}" target="_blank" class="text-blue-600 hover:underline">Glossary</a></h2></div></div>\n`;
    const groupedResources = {};
    const generateResourceList = resource => {
        if (!resource.links.length && !resource.pdfs.length) return "";
        let list = '  <ul class="ml-8 list-none space-y-1">\n';
        for (const link of resource.links) {
            if (!link.text) continue;
            list += `    <li><i class="fa fa-link text-blue-600 me-2"></i><a href="${link.url && link.url.trim() ? link.url : "#"}" target="_blank" class="text-blue-600 hover:underline">${linkDisplay(link)}</a></li>\n`;
        }
        for (const pdf of resource.pdfs) {
            if (!pdf.text) continue;
            list += `    <li><i class="fa fa-file-pdf text-red-600 me-2"></i><a href="${pdfHref(pdf)}" target="_blank" class="ml-1 text-red-600 hover:underline">${pdf.text}</a></li>\n`;
        }
        return list + '  </ul><hr class="bg-yellow-400 border-0 mx-3 my-2 opacity-75 pt-1 shadow">\n';
    };
    let hasModules = false;
    for (const resource of resources) resource.module && (hasModules = true, (groupedResources[resource.module] || (groupedResources[resource.module] = [])).push(resource));
    if (hasModules) for (const [module, moduleResources] of Object.entries(groupedResources)) {
        html += `<div class="bg-yellow-400 rounded-md shadow-md"><div class="rounded-sm bg-gray-100 my-4 p-3 w-full"><h4 class="mb-2 text-2xl font-semibold flex items-center space-x-2"><i class="fa fa-book-open-reader text-green-600"></i><span>${module}</span></h4><hr class="bg-green-600 border border-green-600 mb-3 mt-0 opacity-75 pt-1">`;
        for (const resource of moduleResources) html += `  <h5 class="flex font-semibold items-center mx-3 space-x-2 text-xl"><i class="fa fa-check-circle text-yellow-400"></i><span>${resource.title}</span></h5><hr class="bg-yellow-400 border-0 mx-3 my-2 opacity-75 pt-1 shadow">${generateResourceList(resource)}`;
        html += "</div></div>\n";
    } else for (const resource of resources) html += `<div class="bg-yellow-400 rounded-md shadow-md"><div class="rounded-sm bg-gray-100 my-4 p-3 w-full"><h5 class="flex font-semibold items-center mx-3 space-x-2 text-xl"><i class="fa fa-check-circle text-yellow-400"></i><span>${resource.title}</span></h5><hr class="bg-yellow-400 border-0 mx-3 my-2 opacity-75 pt-1 shadow">${generateResourceList(resource)}</div></div>\n`;
    return html;
}
</script>
</body>
</html>